<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>yokra info</title>
  </head>
  <body>
    <img class="add" id="add_img" src="	https://cdn-icons-png.flaticon.com/512/6711/6711415.png" alt="add button">
    <input class="password" type="text" placeholder="Enter your password">
    <button class="password" id="login-button">login</button>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-analytics.js";
        import { getFirestore , collection, addDoc, getDocs , getDoc } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-storage.js";
      
        // Your web app's Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyC_05cP9iqq6dZ1wB78_r7-XYFrTO7guhM",
          authDomain: "yokraproject-470b9.firebaseapp.com",
          projectId: "yokraproject-470b9",
          storageBucket: "yokraproject-470b9.appspot.com",
          messagingSenderId: "868266877329",
          appId: "1:868266877329:web:ab972b5684b001dc177a30",
          measurementId: "G-FW1ZGF06M6",
          storageBucket: "gs://yokraproject-470b9.appspot.com"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        //initialize the variables
        const products_list = [];
        getData();
        
        //functions
        if(localStorage.getItem('admin_access')){
          document.getElementById("add_img").style.visibility= "visible";
        }else{
          document.getElementById("add_img").style.visibility= "hidden";
        }
        document.getElementById("login-button").addEventListener("click", function(){
          const input_password = document.querySelector(".password").value;
          const real_password = getDocs(collection(db, "users"))
          .then((querySnapshot) => {
            querySnapshot.forEach((doc) => {
              if(doc.data().password == input_password){
                localStorage.setItem('admin_access', "true");
                document.getElementById("add_img").style.visibility= "visible";
                alert("login successful");
              }else{
                alert("wrong password");
                document.getElementById("add_img").style.visibility= "hidden";
                localStorage.setItem('admin_access', "false");
              }
            })
          })
          })
        document.getElementById("add_img").addEventListener("click", function(){
          if(localStorage.getItem('admin_access') == "true"){
              localStorage.setItem('selected_product', "null");  
              window.location.href = "products-edit.html";
            }else{
              alert("you dont have the permission to add products");
            }
        })
        function getData(){
          let i = 0;
          getDocs(collection(db, "products"))
          .then((querySnapshot) => {
            querySnapshot.forEach((doc) => {
              console.log("get data called");
              const corerct_product = {
                id: i,
                type: doc.data().type,
                name: doc.data().name,
                price: doc.data().price,
                uri: doc.data().uri,
                specialNotes: doc.data().specialNotes,
                secondSpecialNotes: doc.data().secondSpecialNotes};
                i++;
              products_list.push(corerct_product);
              show_data(corerct_product);
            })
          })
        }
        function show_data(data){
          //create the elements
          const div_element = document.createElement("div");
          const name_element = document.createElement("a");
          const line_break = document.createElement("hr");
          const type_and_price_element = document.createElement("p");
          const secondSpecialNotes_element = document.createElement("p");
          const image_element = document.createElement("img");
          //name element
          name_element.innerHTML = data.name;
          name_element.href = "products-edit.html";
          name_element.addEventListener("click", function(event){
            if(localStorage.getItem('admin_access') == "true"){
              localStorage.setItem('selected_product', data.name);  
            }else{
              alert("you dont have the permission to edit this product");
              event.preventDefault();
            }
          })
         //type & price element
          type_and_price_element.innerHTML = data.type + " | " + data.price+"â‚ª";
          //secondSpecialNotes element
          secondSpecialNotes_element.innerHTML = data.secondSpecialNotes;
          secondSpecialNotes_element.style.textAlign = "right";
          //image element
          getDownloadURL(ref(storage, data.uri)).then((url) => {

            image_element.src = url;
          })
          //div element
          div_element.className = "card";
          div_element.id = "product " + data.id;
          //append the elements
          div_element.appendChild(name_element);
          div_element.appendChild(type_and_price_element);
          div_element.appendChild(secondSpecialNotes_element);
          div_element.appendChild(line_break);
          div_element.appendChild(image_element);
          document.body.appendChild(div_element);
        }
      </script>
</body>
</html>